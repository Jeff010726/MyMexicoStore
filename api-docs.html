<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢¨è¥¿å“¥ç”µå•†ç‹¬ç«‹ç«™ API æ–‡æ¡£</title>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.10.3/swagger-ui.css" />
    <style>
        html {
            box-sizing: border-box;
            overflow: -moz-scrollbars-vertical;
            overflow-y: scroll;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }
        body {
            margin:0;
            background: #fafafa;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }
        .swagger-ui .topbar {
            background-color: #2563eb;
        }
        .swagger-ui .topbar .download-url-wrapper .select-label {
            color: #fff;
        }
        .swagger-ui .topbar .download-url-wrapper input[type=text] {
            border: 2px solid #fff;
        }
        .swagger-ui .info .title {
            color: #2563eb;
        }
        .custom-header {
            background: linear-gradient(135deg, #2563eb 0%, #f97316 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 0;
        }
        .custom-header h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: bold;
        }
        .custom-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        .api-info {
            background: white;
            padding: 20px;
            margin: 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .api-info h2 {
            color: #2563eb;
            margin-top: 0;
        }
        .api-links {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        .api-links a {
            color: #2563eb;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid #2563eb;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .api-links a:hover {
            background-color: #2563eb;
            color: white;
        }
        #swagger-ui {
            max-width: 1200px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="custom-header">
        <h1>å¢¨è¥¿å“¥ç”µå•†ç‹¬ç«‹ç«™ API æ–‡æ¡£</h1>
        <p>åŸºäº Cloudflare Workers çš„ç°ä»£ç”µå•†å¹³å° RESTful API</p>
    </div>
    
    <div class="api-info">
        <h2>API ä¿¡æ¯</h2>
        <p><strong>åŸºç¡€URL:</strong> <code>https://ecommerce-api.jeff010726bd.workers.dev</code></p>
        <p><strong>ç‰ˆæœ¬:</strong> v1.0.0</p>
        <p><strong>è®¤è¯æ–¹å¼:</strong> Bearer Token (JWT)</p>
        <p><strong>è”ç³»é‚®ç®±:</strong> <a href="mailto:info@aimorelogy.com">info@aimorelogy.com</a></p>
        
        <div class="api-links">
            <a href="./API_DOCUMENTATION.md" target="_blank">ğŸ“– å®Œæ•´æ–‡æ¡£</a>
            <a href="./API_STANDARDS.md" target="_blank">ğŸ“‹ æ¥å£è§„èŒƒ</a>
            <a href="./api-tests.json" target="_blank">ğŸ§ª æµ‹è¯•é›†åˆ</a>
            <a href="./openapi.yaml" target="_blank">ğŸ“„ OpenAPI è§„èŒƒ</a>
        </div>
    </div>

    <div id="swagger-ui"></div>

    <script src="https://unpkg.com/swagger-ui-dist@5.10.3/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.10.3/swagger-ui-standalone-preset.js"></script>
    <script>
        window.onload = function() {
            // è·å–å½“å‰é¡µé¢çš„åŸºç¡€URL
            const baseUrl = window.location.origin + window.location.pathname.replace('/api-docs.html', '');
            
            const ui = SwaggerUIBundle({
                url: baseUrl + '/openapi.yaml',
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "StandaloneLayout",
                defaultModelsExpandDepth: 1,
                defaultModelExpandDepth: 1,
                docExpansion: "list",
                filter: true,
                showExtensions: true,
                showCommonExtensions: true,
                tryItOutEnabled: true,
                requestInterceptor: function(request) {
                    // è‡ªåŠ¨æ·»åŠ è®¤è¯å¤´
                    const token = localStorage.getItem('authToken');
                    if (token && !request.url.includes('/users/register') && !request.url.includes('/users/login')) {
                        request.headers['Authorization'] = 'Bearer ' + token;
                    }
                    return request;
                },
                responseInterceptor: function(response) {
                    // å¤„ç†è®¤è¯å“åº”
                    if (response.url.includes('/users/login') && response.status === 200) {
                        try {
                            const data = JSON.parse(response.text);
                            if (data.success && data.data.token) {
                                localStorage.setItem('authToken', data.data.token);
                                console.log('Token saved to localStorage');
                            }
                        } catch (e) {
                            console.error('Failed to parse login response:', e);
                        }
                    }
                    return response;
                },
                onComplete: function() {
                    console.log('Swagger UI loaded successfully');
                    
                    // æ·»åŠ è‡ªå®šä¹‰æ ·å¼
                    const style = document.createElement('style');
                    style.textContent = `
                        .swagger-ui .info {
                            display: none;
                        }
                        .swagger-ui .scheme-container {
                            background: #f8fafc;
                            padding: 15px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                        }
                        .swagger-ui .auth-wrapper {
                            background: #fef3c7;
                            padding: 15px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                        }
                        .swagger-ui .auth-wrapper .auth-container .auth-btn-wrapper {
                            text-align: center;
                        }
                    `;
                    document.head.appendChild(style);
                    
                    // æ·»åŠ è®¤è¯æç¤º
                    const authInfo = document.createElement('div');
                    authInfo.innerHTML = `
                        <div style="background: #dbeafe; border: 1px solid #3b82f6; border-radius: 8px; padding: 15px; margin: 20px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #1e40af;">ğŸ” è®¤è¯è¯´æ˜</h4>
                            <p style="margin: 0; color: #1e40af;">
                                1. é¦–å…ˆè°ƒç”¨ <strong>POST /users/login</strong> æ¥å£è·å– JWT Token<br>
                                2. Token ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨<br>
                                3. åç»­éœ€è¦è®¤è¯çš„æ¥å£ä¼šè‡ªåŠ¨æ·»åŠ  Authorization å¤´éƒ¨<br>
                                4. æµ‹è¯•è´¦å·ï¼štest@example.com / 123456
                            </p>
                        </div>
                    `;
                    
                    const swaggerContainer = document.querySelector('#swagger-ui');
                    if (swaggerContainer && swaggerContainer.firstChild) {
                        swaggerContainer.insertBefore(authInfo, swaggerContainer.firstChild);
                    }
                }
            });
        };
    </script>
</body>
</html>